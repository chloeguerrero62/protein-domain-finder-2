# Protein Domain Finder 2

## Overview

This repository provides a **fully reproducible pipeline** for large-scale and per-protein domain boundary discovery using 3D protein structure data.  
All of the main analyses, summary tables, and publication-quality figures corresponding to the presentation ("Protein-Domain-Finder.pdf") can be generated using the provided `protein_domain_workflow.ipynb` [Jupyter Notebook](./protein_domain_workflow.ipynb) and supporting scripts.

---

## Quick Start

### 1. Clone and Install Dependencies

```bash
git clone https://github.com/chloeguerrero62/protein-domain-finder-2.git
cd protein-domain-finder-2
pip install -r requirements.txt
# or, if using Conda:
# conda env create -f environment.yml
# conda activate protein-domain-finder
```

### 2. Run the Comprehensive Notebook

Open Jupyter Notebook/Lab from the repo root:
```bash
jupyter notebook protein_domain_workflow.ipynb
# or
jupyter lab protein_domain_workflow.ipynb
```
Run all cells from top to bottom. The notebook will automatically:
- Execute all analyses steps/scripts in order
- Generate and display all results and figures as in the PDF/main presentation

---

## Workflow Structure

### Main Notebook: [`protein_domain_workflow.ipynb`](./protein_domain_workflow.ipynb)

- **End-to-end, click-to-reproduce workflow** matching the full pipeline and analyses in the paper/presentation.
- Organized into sections:
    1. **Environment & Setup**
    2. **Data Preparation:**  
        - Structure (PDB) download (`scripts/download_selected_pdbs.py`)
        - Per-protein distance matrix computation (`scripts/distance_matrix.py`)
        - Residue-residue graph build (`scripts/graph_builder.py`)
    3. **Clustering & Domain Assignment:**  
        - Louvain, spectral, two-stage, hierarchical, and comparison analyses (`scripts/louvain_clustering.py`,  `scripts/compare_all_methods.py`)
    4. **Controls, Ablations & Benchmarking:**  
        - Random controls and ablations: `scripts/random_controls.py`
        - Performance benchmarking: `scripts/performance_benchmarking.py`
        - (Optional) Hyperparameter optimization: `scripts/hyperparameter_optimization.py`
    5. **Summary Tables & Publication Figures:**  
        - All tables/figures/panels from the PDF, generated by `scripts/create_figs.py`
        - Figures displayed inline in the notebook automatically
    6. **Domain Visualization:**  
        - Per-protein cluster/partition visualization: `scripts/visualize_domains.py`
    7. **Output:**  
        - All result tables and figures are viewable in the notebook and saved to `data/results/` and `data/results/figures/`

---

### Directory Structure

```
protein-domain-finder-2/
│
├── protein_domain_workflow.ipynb       # Main pipeline notebook (start here!)
├── scripts/                            # Modular analysis and figure-generation scripts
│   ├── download_selected_pdbs.py
│   ├── distance_matrix.py
│   ├── graph_builder.py
│   ├── louvain_clustering.py
│   ├── compare_all_methods.py
│   ├── create_figs.py
│   ├── random_controls.py
│   ├── performance_benchmarking.py
│   ├── hyperparameter_optimization.py
│   ├── visualize_domains.py
│   └── ... (see each for detailed purpose)
│
├── src/                                # Main pipeline code (imported by scripts)
├── data/                               # Input CSVs, result files, output/figures
│   ├── pdb_clustering/selected_proteins_mmseqs2.csv
│   ├── selected_structures/            # Downloaded PDBs (not in git)
│   ├── distance_matrices/              # Matrix numpy output
│   ├── graphs/                         # Pickled graphs
│   ├── clusters/                       # Clustering partitions
│   ├── results/                        # Comparison tables, logs, and figures/
│   └── visualizations/                 # Per-protein domain assignment figures
│
├── requirements.txt / environment.yml  # Dependency lists
├── README.md                           # This file
├── Protein-Domain-Finder.pdf           # Presentation (figures match outputs)
└── ...
```

---

## How Figures and Tables Are Generated

- **All** tables and figures in the paper and PDF/presentation are **generated or summarized** by the notebook, via:
    - `scripts/create_figs.py`: Main publication-ready composite figures
    - `scripts/visualize_domains.py`: Individual domain assignment visualizations
    - `scripts/compare_all_methods.py`: Method result logs/tables
    - See [protein_domain_workflow.ipynb](./protein_domain_workflow.ipynb) for how each is invoked and displayed

**Output will match what you see in `Protein-Domain-Finder.pdf`.**

---

## Regenerating the Full Pipeline

The pipeline can be regenerated from scratch by running the main notebook:
- Results and figures will be (re)created in `data/results/` and subfolders.
- Intermediate files are cached, so restarting from any stage is efficient.

If you want to use or display any figure, check `data/results/figures/`.

---

## Troubleshooting

- **Missing Packages:**  
  Run `pip install -r requirements.txt` or `conda env create -f environment.yml`.
- **File Not Found Errors:**  
  - Ensure you have run all previous cells/scripts in order.
  - Ensure `data/pdb_clustering/selected_proteins_mmseqs2.csv` is present for sample analysis.
- **Visualization Issues:**  
  All images/tables are auto-displayed inline, but figures can also be opened from the file system.


